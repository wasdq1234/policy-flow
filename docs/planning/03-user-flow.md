# User Flow (사용자 흐름도): PolicyFlow KR

> 정책 캘린더 서비스의 핵심 사용자 여정

---

## MVP 캡슐

| # | 항목 | 내용 |
|---|------|------|
| 1 | 목표 | 모든 국민이 자신에게 해당하는 정책 자금을 단 1원도 놓치지 않도록 돕는다 |
| 2 | 페르소나 | 취업준비생 김민수(26세), 소상공인 이영희(45세) |
| 3 | 핵심 기능 | FEAT-1: 정책 캘린더 (맞춤형 정책 시각화) |
| 4 | 성공 지표 (노스스타) | MAU 10,000명 |
| 5 | 입력 지표 | 북마크 정책 수, 푸시 알림 허용률 |
| 6 | 비기능 요구 | 서버 비용 0원 (Cloudflare 무료 티어) |
| 7 | Out-of-scope | 다크모드, 모바일 앱, 정책 신청 대행 |
| 8 | Top 리스크 | 공공 API 변경/중단 시 데이터 수집 불가 |
| 9 | 완화/실험 | Health Check Worker + 사용자 제보 시스템 |
| 10 | 다음 단계 | Cloudflare 계정 세팅 및 D1 데이터베이스 생성 |

---

## 1. 전체 사용자 여정 (Overview)

```mermaid
graph TD
    A[앱 진입] --> B{로그인 상태?}
    B -->|No| C[FEAT-0: 온보딩/설정]
    B -->|Yes| D[메인: 캘린더]
    C --> D
    D --> E[FEAT-1: 정책 조회/필터링]
    E --> F[FEAT-2: 북마크/알림 설정]
    F --> G[FEAT-3: 커뮤니티 참여]
    G --> H{정책 신청?}
    H -->|Yes| I[외부 신청 페이지]
    H -->|No| D
    I --> J[리텐션: 마감 알림]
    J --> D
```

---

## 2. FEAT-0: 온보딩/설정 플로우

```mermaid
graph TD
    A[첫 방문] --> B{기존 기기 토큰?}

    %% 기존 사용자 (자동 로그인)
    B -->|Yes| C[자동 로그인]
    C --> D[메인 캘린더]

    %% 신규 사용자
    B -->|No| E[웰컴 화면]
    E --> F{로그인 방식 선택}

    F -->|소셜 로그인| G[Google/Kakao OAuth]
    F -->|비로그인 체험| H[Guest 모드]

    G --> I[프로필 설정]
    H --> J[제한 안내 팝업]
    J --> D

    I --> K[나이대 선택]
    K --> L[거주 지역 선택]
    L --> M[관심 분야 선택]
    M --> N[푸시 알림 권한 요청]
    N --> D
```

---

## 3. FEAT-1: 정책 캘린더 플로우

```mermaid
graph TD
    A[캘린더 화면] --> B[이번 달 정책 표시]
    B --> C{뷰 선택}

    C -->|캘린더 뷰| D[월간 캘린더]
    C -->|리스트 뷰| E[날짜별 리스트]

    D --> F[정책 바 클릭]
    E --> G[정책 카드 클릭]

    F --> H[정책 상세 모달]
    G --> H

    H --> I{다음 액션}
    I -->|신청하기| J[외부 링크 이동]
    I -->|북마크| K[북마크 추가]
    I -->|게시판| L[정책 게시판 이동]
    I -->|닫기| A

    %% 필터링
    A --> M[필터 버튼]
    M --> N[필터 패널]
    N --> O[지역 선택]
    N --> P[분야 선택]
    N --> Q[상태 선택]
    O --> R[필터 적용]
    P --> R
    Q --> R
    R --> A
```

### 3.1 정책 상세 모달 구조

```mermaid
graph LR
    A[정책 상세] --> B[제목/요약]
    A --> C[신청 기간 강조]
    A --> D[지원 내용]
    A --> E[신청 자격]
    A --> F[신청 방법]
    A --> G[관련 게시글 미리보기]
    A --> H[액션 버튼들]

    H --> I[신청 페이지 이동]
    H --> J[북마크 토글]
    H --> K[공유하기]
```

---

## 4. FEAT-2: 북마크 & 알림 플로우

```mermaid
graph TD
    A[정책 상세] --> B[북마크 버튼 클릭]
    B --> C{로그인 상태?}

    C -->|No| D[로그인 유도 팝업]
    D --> E[소셜 로그인]
    E --> F[북마크 완료]

    C -->|Yes| F
    F --> G{첫 북마크?}

    G -->|Yes| H[푸시 알림 권한 요청]
    H --> I{허용?}
    I -->|Yes| J[FCM 토큰 등록]
    I -->|No| K[알림 없이 진행]

    G -->|No| L[알림 설정 확인]

    J --> L
    K --> L

    L --> M[마이페이지: 북마크 목록]
    M --> N[개별 알림 설정]
    N --> O[마감 3일 전 알림]
    N --> P[마감 1일 전 알림]
```

### 4.1 푸시 알림 수신 플로우

```mermaid
graph TD
    A[Cron: 매일 오전 9시] --> B[마감 임박 정책 조회]
    B --> C{북마크 사용자?}

    C -->|Yes| D[FCM 푸시 발송]
    D --> E[사용자 기기]
    E --> F[알림 클릭]
    F --> G[앱 진입]
    G --> H[해당 정책 상세]
```

---

## 5. FEAT-3: 커뮤니티 게시판 플로우

```mermaid
graph TD
    A[게시판 진입] --> B{진입 경로}

    B -->|정책 상세에서| C[해당 정책 게시판]
    B -->|메뉴에서| D[전체/자유 게시판]

    C --> E[게시글 목록]
    D --> E

    E --> F{액션}
    F -->|글 읽기| G[게시글 상세]
    F -->|글 쓰기| H[작성 폼]

    %% 게시글 상세
    G --> I[본문 + 댓글]
    I --> J{액션}
    J -->|좋아요| K[좋아요 토글]
    J -->|댓글 달기| L[댓글 작성]
    J -->|신고| M[신고 처리]

    %% 게시글 작성
    H --> N{로그인?}
    N -->|No| O[로그인 유도]
    N -->|Yes| P[유형 선택]
    P --> Q[닉네임 설정]
    Q --> R[제목/내용 작성]
    R --> S{검증}
    S -->|통과| T[게시 완료]
    S -->|실패| U[에러 표시]
    U --> R
    T --> E
```

### 5.1 댓글/대댓글 플로우

```mermaid
graph TD
    A[게시글 상세] --> B[댓글 목록]
    B --> C[댓글 입력창]

    C --> D{로그인?}
    D -->|No| E[로그인 유도]
    D -->|Yes| F[댓글 작성]

    F --> G{대댓글?}
    G -->|Yes| H[답글 달기 클릭]
    H --> I[대댓글 입력창]
    I --> J[대댓글 제출]

    G -->|No| K[댓글 제출]

    J --> L[댓글 목록 갱신]
    K --> L

    B --> M[댓글 좋아요]
    B --> N[댓글 신고]
```

---

## 6. 리텐션 루프 (습관 형성)

```mermaid
graph TD
    A[북마크 완료] --> B[알림 설정]
    B --> C[시간 경과]

    %% 푸시 알림 루프
    C --> D[마감 3일 전]
    D --> E[푸시 알림 발송]
    E --> F[앱 재진입]
    F --> G[정책 확인]
    G --> H{신청?}
    H -->|Yes| I[외부 신청 페이지]
    H -->|No| J[재알림 설정]

    %% 자연 재방문
    C --> K[새 정책 추가 시]
    K --> L[관심 분야 매칭]
    L --> M[푸시 알림]
    M --> F

    %% 게시판 활동
    I --> N[신청 완료]
    N --> O[후기 작성 유도]
    O --> P[게시판 참여]
    P --> Q[좋아요/댓글 알림]
    Q --> F
```

---

## 7. 에러 처리 플로우

```mermaid
graph TD
    A[에러 발생] --> B{에러 유형}

    B -->|네트워크 오류| C[재시도 버튼]
    C --> D{재시도?}
    D -->|Yes| E[재요청]
    D -->|No| F[오프라인 캐시 표시]

    B -->|API 데이터 오류| G[정보 오류 신고]
    G --> H[사용자 제보 폼]
    H --> I[제보 접수 완료]

    B -->|로그인 만료| J[자동 토큰 갱신]
    J --> K{갱신 성공?}
    K -->|Yes| L[원래 요청 재시도]
    K -->|No| M[재로그인 유도]

    B -->|Rate Limit| N[잠시 후 재시도 안내]
    N --> O[대기 타이머 표시]

    B -->|서버 오류| P[고객센터 안내]
    P --> Q[문의 폼 링크]
```

---

## 8. 화면 목록 (Screen Inventory)

| 화면 ID | 화면명 | FEAT | 진입점 | 주요 액션 |
|---------|--------|------|--------|----------|
| S-01 | 웰컴 화면 | FEAT-0 | 첫 방문 | 로그인 방식 선택 |
| S-02 | 소셜 로그인 | FEAT-0 | S-01 | Google/Kakao 인증 |
| S-03 | 프로필 설정 | FEAT-0 | S-02 | 나이/지역/관심분야 설정 |
| S-04 | 메인 캘린더 | FEAT-1 | S-03, 자동로그인 | 정책 조회, 필터링 |
| S-05 | 정책 상세 모달 | FEAT-1 | S-04 | 상세 확인, 북마크, 신청 이동 |
| S-06 | 필터 패널 | FEAT-1 | S-04 | 지역/분야/상태 필터 |
| S-07 | 마이페이지 | FEAT-2 | 하단 탭 | 설정, 북마크 관리 |
| S-08 | 북마크 목록 | FEAT-2 | S-07 | 북마크 확인, 알림 설정 |
| S-09 | 게시판 목록 | FEAT-3 | 하단 탭, S-05 | 게시글 조회 |
| S-10 | 게시글 상세 | FEAT-3 | S-09 | 읽기, 댓글, 좋아요 |
| S-11 | 게시글 작성 | FEAT-3 | S-09 | 글 작성 |
| S-12 | 푸시 알림 설정 | FEAT-2 | S-07 | 알림 on/off |

---

## 9. 네비게이션 구조

```mermaid
graph TD
    A[하단 탭 네비게이션] --> B[캘린더 탭]
    A --> C[게시판 탭]
    A --> D[마이페이지 탭]

    B --> E[메인 캘린더 S-04]
    E --> F[정책 상세 모달 S-05]
    E --> G[필터 패널 S-06]

    C --> H[게시판 목록 S-09]
    H --> I[게시글 상세 S-10]
    H --> J[게시글 작성 S-11]

    D --> K[마이페이지 S-07]
    K --> L[북마크 목록 S-08]
    K --> M[푸시 설정 S-12]
    K --> N[프로필 수정 S-03]
```

---

## Decision Log

| # | 결정 | 이유 |
|---|------|------|
| 1 | 하단 탭 3개 (캘린더/게시판/마이페이지) | 모바일 친화적, 핵심 기능 빠른 접근 |
| 2 | 정책 상세는 모달로 | 컨텍스트 유지, 빠른 닫기 |
| 3 | 첫 북마크 시 푸시 권한 요청 | 적절한 타이밍, 가치 인지 후 요청 |
| 4 | Guest 모드 허용 | 진입 장벽 낮춤, 기능 체험 후 전환 유도 |
